---
title: "EDA"
author: "R.M. Palmer"
date: "11/15/2019"
output: html_document
---

```{r eda, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gridExtra)
library(grid)
library(ggplot2)
library(lattice)

```

```{r child = 'dataload.Rmd'}
```

```{r sanity_check}
# check for NA values
train_raw %>% 
  select_if(function(x) any(is.na(x))) %>% 
  summarise_each(funs(sum(is.na(.)))) -> raw_NA
```

```{r plot_wage_rates}
# want to plot against MonthlyIncome
# - DailyRate
# - HourlyRate
# - MonthlyRate
#
train_raw %>% ggplot() +
  geom_line(aes(x=MonthlyIncome,y=DailyRate,color="red")) 
train_raw %>% ggplot() +
  geom_line(aes(x=MonthlyIncome,y=HourlyRate,color="blue")) 
train_raw %>% ggplot() +
  geom_line(aes(x=MonthlyIncome,y=MonthlyRate,color="green"))
```


```{r crossplot_wage_rates}
# these rates seem to be unrelated to income.
train_raw %>% 
  select(MonthlyIncome,DailyRate,HourlyRate,MonthlyRate) %>% pairs()
```

```{r crossplot_years}
train_raw %>%
  select(YearsAtCompany,
         YearsInCurrentRole,
         YearsSinceLastPromotion,
         YearsWithCurrManager,
         NumCompaniesWorked) %>% pairs()
```

```{r crossplot_education}
train_raw %>% 
  select(Education,
         JobLevel,
         YearsAtCompany) %>% pairs()
```

```{r}
# histogram of Monthly Income, broken down by each of the 8 categorical varibles
# BusinessTravel
# Department
# EducationField
# Gender
# JobRole
# MaritalStatus
# OverTime
train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~BusinessTravel)

train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~Department)

train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~EducationField)

train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~Gender)

train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~JobRole)

train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~MaritalStatus)

train_raw %>% ggplot(mapping=aes(x=MonthlyIncome)) +
  geom_histogram() + facet_wrap(~OverTime)

```

## good idea to test statistical significance of the categorical variables

```{r}
## should any of the variables be transformed (logs?)
train_raw %>% ggplot(aes(sample=Age)) + stat_qq() + ggtitle('Age')
train_raw %>% ggplot(aes(sample=DistanceFromHome)) + stat_qq() + ggtitle('Distance From Home')
train_raw %>% ggplot(aes(sample=MonthlyIncome)) + stat_qq() + ggtitle('MonthlyIncome')

train_raw %>% ggplot(aes(x=Age)) + geom_histogram() + ggtitle('Age')
train_raw %>% ggplot(aes(x=DistanceFromHome)) + geom_histogram() + ggtitle('DistanceFromHome')
train_raw %>% ggplot(aes(x=MonthlyIncome)) + geom_histogram() + ggtitle('MonthlyIncome')

```

```{r}
train_raw %>% mutate(logincome = log(MonthlyIncome)) %>% ggplot(aes(x=logincome)) + geom_histogram() + ggtitle('log income')
train_raw %>% mutate(sqrtdist = sqrt(DistanceFromHome)) %>% ggplot(aes(x=sqrtdist)) + geom_histogram() + ggtitle('sqrt distance')
```

```{r make_histograms}
cuberoot <- function(arg)
{
  return(arg^(1/3))
}
mylog <- function(arg)
{
  return (log(1+arg))
}
noop <- function(arg)
{
  return(arg)
}
myqc <- function(varname,fptr=noop)
{
  index <- which(colnames(train_raw)==varname)
  one_col <- train_raw %>% select(index)
  colnames(one_col)  <- c('x')
  p1 <- one_col %>% mutate(new_value = fptr(x)) %>% 
                             ggplot(aes(x=new_value)) + geom_histogram() + ggtitle(varname)
  p2 <- one_col %>% mutate(new_value = fptr(x)) %>%
                             ggplot(aes(sample=new_value)) + stat_qq() + ggtitle(varname)
  grid.arrange(p1,p2,nrow=1)
}
myqc <- function(varname,zb=0)
{
  index <- which(colnames(train_raw)==varname)
  nbins <- 21
  one_col <- train_raw %>% select(index)
  colnames(one_col)  <- c('x')
  p1 <- one_col %>% ggplot(aes(x=x)) + geom_histogram(bins=nbins) + ggtitle(varname)
  p2 <- one_col %>% ggplot(aes(sample=x)) + stat_qq() + ggtitle(varname)
  p3 <- one_col %>% mutate(new_value = log(x+zb)) %>%
    ggplot(aes(x=new_value)) + geom_histogram(bins=nbins) + ggtitle(paste('log',varname))
  p4 <- one_col %>% mutate(new_value = log(x+zb)) %>%
    ggplot(aes(sample=new_value)) + stat_qq() + ggtitle(paste('log',varname))
  p5 <- one_col %>% mutate(new_value = sqrt(x+zb)) %>%
    ggplot(aes(x=new_value)) + geom_histogram(bins=nbins) + ggtitle(paste('sqrt',varname))
  p6 <- one_col %>% mutate(new_value = sqrt(x+zb)) %>%
    ggplot(aes(sample=new_value)) + stat_qq() + ggtitle(paste('sqrt',varname))
  grid.arrange(p1,p2,p3,p4,p5,p6,nrow=3)
}

myqc('Age')
myqc('DistanceFromHome')
myqc('MonthlyIncome')
myqc('YearsAtCompany',1)
myqc('YearsSinceLastPromotion',1)
myqc('YearsWithCurrManager',1)
myqc('WorkLifeBalance')
myqc('TotalWorkingYears',1)
myqc('PerformanceRating')
myqc('PercentSalaryHike')
myqc('JobLevel')
myqc('StockOptionLevel',1)
myqc('Education')
myqc('EnvironmentSatisfaction')
myqc('JobInvolvement')
myqc('JobSatisfaction')
myqc('NumCompaniesWorked',1)
myqc('RelationshipSatisfaction')
myqc('TrainingTimesLastYear',1)
myqc('WorkLifeBalance')
myqc('YearsInCurrentRole',1)
```
















